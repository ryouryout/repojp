<!DOCTYPE html>
<html lang="ja" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Love Match - 気の合う相手とメッセージを交換して繋がりを深めましょう">
    <meta name="theme-color" content="#4F46E5">
    <title>メッセージ - Love Match</title>
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icons/icon-192x192.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="assets/styles.css">
    <!-- ダークモード初期化スクリプト -->
    <script>
        // ダークモードの初期化 - ページ読み込み時のちらつきを防止
        if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark');
        } else {
            document.documentElement.classList.remove('dark');
        }
    </script>
    <style>
        body {
            font-family: 'Noto Sans JP', sans-serif;
        }
        
        /* グラデーション背景 */
        .gradient-bg {
            background: linear-gradient(135deg, #EEF2FF 0%, #C7D2FE 100%);
        }
        
        /* ダークモード時のグラデーション背景 */
        .dark .gradient-bg {
            background: linear-gradient(135deg, #1E1B4B 0%, #3730A3 100%);
        }
        
        /* モバイルメニュー */
        .mobile-menu-transition {
            transition: all 0.3s ease-in-out;
        }
        
        /* メッセージリスト項目 */
        .message-item {
            transition: all 0.2s ease;
            border-left: 3px solid transparent;
        }
        
        .message-item:hover, .message-item.active {
            background-color: rgba(79, 70, 229, 0.1);
            border-left: 3px solid #4F46E5;
        }
        
        .dark .message-item:hover, .dark .message-item.active {
            background-color: rgba(129, 140, 248, 0.2);
            border-left: 3px solid #818CF8;
        }
        
        /* メッセージ本文スタイル */
        .message-bubble {
            border-radius: 18px;
            max-width: 75%;
            margin-bottom: 10px;
            padding: 10px 15px;
            position: relative;
            animation: fadeIn 0.3s ease;
        }
        
        .message-bubble.user {
            background-color: #4F46E5;
            color: white;
            border-bottom-right-radius: 4px;
            align-self: flex-end;
        }
        
        .message-bubble.ai {
            background-color: #E2E8F0;
            color: #1F2937;
            border-bottom-left-radius: 4px;
            align-self: flex-start;
        }
        
        .dark .message-bubble.ai {
            background-color: #4B5563;
            color: #F3F4F6;
        }
        
        /* タイピングインジケーター */
        .typing-indicator {
            display: flex;
            align-items: center;
            margin: 10px 0;
        }
        
        .typing-indicator span {
            height: 8px;
            width: 8px;
            background-color: #4F46E5;
            border-radius: 50%;
            display: inline-block;
            margin-right: 5px;
            opacity: 0.6;
        }
        
        .typing-indicator span:nth-child(1) {
            animation: typing 1s infinite;
        }
        
        .typing-indicator span:nth-child(2) {
            animation: typing 1s infinite 0.3s;
        }
        
        .typing-indicator span:nth-child(3) {
            animation: typing 1s infinite 0.6s;
        }
        
        @keyframes typing {
            0% { transform: scale(1); }
            50% { transform: scale(1.5); }
            100% { transform: scale(1); }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* プロフィールカード */
        .profile-card {
            transition: all 0.3s ease;
            border: 2px solid transparent;
            cursor: pointer;
        }
        
        .profile-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            border-color: #4F46E5;
        }
        
        .dark .profile-card:hover {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3), 0 4px 6px -2px rgba(0, 0, 0, 0.2);
            border-color: #818CF8;
        }
        
        /* モバイル表示の最適化 */
        @media (max-width: 768px) {
            .message-bubble {
                max-width: 85%;
            }
        }
    </style>
</head>
<body class="bg-gray-50 dark:bg-gray-900">
    <!-- ナビゲーションバー -->
    <nav class="bg-white shadow-lg fixed w-full z-50 dark:bg-gray-800">
        <div class="max-w-7xl mx-auto px-4">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <a href="dashboard.html" class="text-2xl font-bold text-indigo-600 dark:text-indigo-400">Love Match</a>
                </div>
                <div class="hidden md:flex items-center space-x-4">
                    <a href="dashboard.html" class="nav-link text-gray-600 hover:text-indigo-600 dark:text-gray-300 dark:hover:text-indigo-400 px-3 py-2 rounded-md transition-all duration-300">
                        <i class="fas fa-home mr-1"></i> ダッシュボード
                    </a>
                    <a href="matching.html" class="nav-link text-gray-600 hover:text-indigo-600 dark:text-gray-300 dark:hover:text-indigo-400 px-3 py-2 rounded-md transition-all duration-300">
                        <i class="fas fa-heart mr-1"></i> マッチング
                    </a>
                    <a href="messages.html" class="nav-link text-indigo-600 dark:text-indigo-400 font-medium px-3 py-2 rounded-md bg-indigo-50 dark:bg-indigo-900/30 transition-all duration-300">
                        <i class="fas fa-comments mr-1"></i> メッセージ
                    </a>
                    <a href="profile-edit.html" class="nav-link text-gray-600 hover:text-indigo-600 dark:text-gray-300 dark:hover:text-indigo-400 px-3 py-2 rounded-md transition-all duration-300">
                        <i class="fas fa-user mr-1"></i> プロフィール
                    </a>
                    <button id="darkModeToggle" class="text-gray-600 hover:text-indigo-600 dark:text-gray-300 dark:hover:text-indigo-400 p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 transition-all duration-300">
                        <i class="fas fa-moon dark:hidden"></i>
                        <i class="fas fa-sun hidden dark:inline"></i>
                    </button>
                </div>
                <div class="md:hidden flex items-center">
                    <button id="mobileMenuButton" class="text-gray-600 hover:text-indigo-600 dark:text-gray-300 dark:hover:text-indigo-400 p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 transition-all duration-300">
                        <i class="fas fa-bars text-xl"></i>
                    </button>
                </div>
            </div>
        </div>
        <!-- モバイルメニュー -->
        <div id="mobileMenu" class="hidden md:hidden bg-white dark:bg-gray-800 shadow-lg mobile-menu-transition">
            <div class="px-2 pt-2 pb-3 space-y-1">
                <a href="dashboard.html" class="nav-link block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:text-indigo-600 hover:bg-gray-100 dark:text-gray-300 dark:hover:text-indigo-400 dark:hover:bg-gray-700 transition-all duration-300">
                    <i class="fas fa-home mr-1"></i> ダッシュボード
                </a>
                <a href="matching.html" class="nav-link block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:text-indigo-600 hover:bg-gray-100 dark:text-gray-300 dark:hover:text-indigo-400 dark:hover:bg-gray-700 transition-all duration-300">
                    <i class="fas fa-heart mr-1"></i> マッチング
                </a>
                <a href="messages.html" class="nav-link block px-3 py-2 rounded-md text-base font-medium text-indigo-600 bg-indigo-50 dark:text-indigo-400 dark:bg-indigo-900/30 transition-all duration-300">
                    <i class="fas fa-comments mr-1"></i> メッセージ
                </a>
                <a href="profile-edit.html" class="nav-link block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:text-indigo-600 hover:bg-gray-100 dark:text-gray-300 dark:hover:text-indigo-400 dark:hover:bg-gray-700 transition-all duration-300">
                    <i class="fas fa-user mr-1"></i> プロフィール
                </a>
                <button id="mobileDarkModeToggle" class="w-full text-left px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:text-indigo-600 hover:bg-gray-100 dark:text-gray-300 dark:hover:text-indigo-400 dark:hover:bg-gray-700 transition-all duration-300">
                    <i class="fas fa-moon mr-1 dark:hidden"></i>
                    <i class="fas fa-sun mr-1 hidden dark:inline"></i>
                    <span class="dark-mode-text">ダークモード</span>
                </button>
                <a href="index.html" class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:text-indigo-600 hover:bg-gray-100 dark:text-gray-300 dark:hover:text-indigo-400 dark:hover:bg-gray-700 transition-all duration-300">
                    <i class="fas fa-sign-out-alt mr-1"></i> ログアウト
                </a>
            </div>
        </div>
    </nav>

    <!-- メインコンテンツ -->
    <div class="pt-16 min-h-screen flex flex-col">
        <!-- キャラクター選択画面 -->
        <div id="character-selection" class="flex-grow flex flex-col items-center justify-center px-4 py-8 gradient-bg dark:text-white">
            <h1 class="text-2xl font-bold mb-8 text-center">誰とお話ししますか？</h1>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 max-w-4xl">
                <!-- さくらのカード -->
                <div class="profile-card bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 text-center" onclick="selectCharacter('sakura')">
                    <div class="relative w-32 h-32 mx-auto mb-4">
                        <img src="https://images.unsplash.com/photo-1438761681033-6461ffad8d80?w=200&q=80" alt="さくら" class="w-full h-full object-cover rounded-full border-4 border-indigo-100 dark:border-indigo-900">
                        <div class="absolute bottom-0 right-0 bg-green-500 w-5 h-5 rounded-full border-2 border-white dark:border-gray-800"></div>
                    </div>
                    <h2 class="text-xl font-bold text-gray-800 dark:text-white">さくら</h2>
                    <p class="text-sm text-gray-600 dark:text-gray-300 mb-2">24歳・大学院生</p>
                    <p class="text-gray-700 dark:text-gray-300 mb-3">カフェ巡りと読書が好きな知的な女性。アートに興味があります。</p>
                    <div class="flex justify-center space-x-2 mb-4">
                        <span class="bg-indigo-100 text-indigo-800 text-xs font-medium px-2.5 py-0.5 rounded dark:bg-indigo-900 dark:text-indigo-300">アート</span>
                        <span class="bg-indigo-100 text-indigo-800 text-xs font-medium px-2.5 py-0.5 rounded dark:bg-indigo-900 dark:text-indigo-300">読書</span>
                        <span class="bg-indigo-100 text-indigo-800 text-xs font-medium px-2.5 py-0.5 rounded dark:bg-indigo-900 dark:text-indigo-300">カフェ</span>
                    </div>
                    <p class="text-sm text-gray-500 dark:text-gray-400">知的で優しい性格です</p>
                </div>
                
                <!-- みきのカード -->
                <div class="profile-card bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 text-center" onclick="selectCharacter('miki')">
                    <div class="relative w-32 h-32 mx-auto mb-4">
                        <img src="https://images.unsplash.com/photo-1494790108377-be9c29b29330?w=200&q=80" alt="みき" class="w-full h-full object-cover rounded-full border-4 border-indigo-100 dark:border-indigo-900">
                        <div class="absolute bottom-0 right-0 bg-green-500 w-5 h-5 rounded-full border-2 border-white dark:border-gray-800"></div>
                    </div>
                    <h2 class="text-xl font-bold text-gray-800 dark:text-white">みき</h2>
                    <p class="text-sm text-gray-600 dark:text-gray-300 mb-2">26歳・フリーランスカメラマン</p>
                    <p class="text-gray-700 dark:text-gray-300 mb-3">音楽フェスと路上写真が好きな活発な女性。</p>
                    <div class="flex justify-center space-x-2 mb-4">
                        <span class="bg-indigo-100 text-indigo-800 text-xs font-medium px-2.5 py-0.5 rounded dark:bg-indigo-900 dark:text-indigo-300">音楽</span>
                        <span class="bg-indigo-100 text-indigo-800 text-xs font-medium px-2.5 py-0.5 rounded dark:bg-indigo-900 dark:text-indigo-300">写真</span>
                        <span class="bg-indigo-100 text-indigo-800 text-xs font-medium px-2.5 py-0.5 rounded dark:bg-indigo-900 dark:text-indigo-300">旅行</span>
                    </div>
                    <p class="text-sm text-gray-500 dark:text-gray-400">芸術的でにぎやかな性格です</p>
                </div>
                
                <!-- ゆきのカード -->
                <div class="profile-card bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 text-center" onclick="selectCharacter('yuki')">
                    <div class="relative w-32 h-32 mx-auto mb-4">
                        <img src="https://images.unsplash.com/photo-1494790108377-be9c29b29330?w=200&q=80" alt="ゆき" class="w-full h-full object-cover rounded-full border-4 border-indigo-100 dark:border-indigo-900">
                        <div class="absolute bottom-0 right-0 bg-green-500 w-5 h-5 rounded-full border-2 border-white dark:border-gray-800"></div>
                    </div>
                    <h2 class="text-xl font-bold text-gray-800 dark:text-white">ゆき</h2>
                    <p class="text-sm text-gray-600 dark:text-gray-300 mb-2">23歳・ジムインストラクター</p>
                    <p class="text-gray-700 dark:text-gray-300 mb-3">健康的な生活を大事にする女性。ピクニックやヨガが好き。</p>
                    <div class="flex justify-center space-x-2 mb-4">
                        <span class="bg-indigo-100 text-indigo-800 text-xs font-medium px-2.5 py-0.5 rounded dark:bg-indigo-900 dark:text-indigo-300">スポーツ</span>
                        <span class="bg-indigo-100 text-indigo-800 text-xs font-medium px-2.5 py-0.5 rounded dark:bg-indigo-900 dark:text-indigo-300">ヨガ</span>
                        <span class="bg-indigo-100 text-indigo-800 text-xs font-medium px-2.5 py-0.5 rounded dark:bg-indigo-900 dark:text-indigo-300">料理</span>
                    </div>
                    <p class="text-sm text-gray-500 dark:text-gray-400">フレンドリーで明るい性格です</p>
                </div>
            </div>
        </div>
        
        <!-- チャット画面 -->
        <div id="chat-container" class="hidden flex-grow flex flex-col h-screen">
            <!-- チャットヘッダー -->
            <div class="chat-header bg-white dark:bg-gray-800 shadow p-4 flex items-center">
                <button id="back-button" class="mr-3 text-gray-600 dark:text-gray-300 hover:text-indigo-600 dark:hover:text-indigo-400">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <div class="relative">
                    <img id="chat-avatar" src="" alt="プロフィール画像" class="w-10 h-10 rounded-full border-2 border-indigo-100 dark:border-indigo-900">
                    <div class="absolute bottom-0 right-0 bg-green-500 w-3 h-3 rounded-full border border-white dark:border-gray-800"></div>
                </div>
                <div class="ml-3">
                    <h2 id="chat-name" class="text-md font-semibold text-gray-800 dark:text-white">-</h2>
                    <p class="text-xs text-green-600 dark:text-green-400">オンライン</p>
                </div>
            </div>
            
            <!-- メッセージエリア -->
            <div id="messages-container" class="flex-grow overflow-y-auto p-4 bg-gray-100 dark:bg-gray-900">
                <!-- メッセージはJavaScriptで追加されます -->
            </div>
            
            <!-- メッセージ入力フォーム -->
            <div class="bg-white dark:bg-gray-800 border-t dark:border-gray-700 p-4">
                <form id="message-form" class="flex">
                    <input type="text" id="message-input" class="flex-grow px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-l-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 dark:bg-gray-700 dark:text-white" placeholder="メッセージを入力...">
                    <button type="submit" class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-r-lg transition duration-300">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </form>
            </div>
        </div>
    </div>
    
    <script>
        // ダークモードトグル
        function setupDarkMode() {
            const darkModeToggle = document.getElementById('darkModeToggle');
            const mobileDarkModeToggle = document.getElementById('mobileDarkModeToggle');
            
            function toggleDarkMode() {
                if (document.documentElement.classList.contains('dark')) {
                    document.documentElement.classList.remove('dark');
                    localStorage.theme = 'light';
                } else {
                    document.documentElement.classList.add('dark');
                    localStorage.theme = 'dark';
                }
            }
            
            if (darkModeToggle) darkModeToggle.addEventListener('click', toggleDarkMode);
            if (mobileDarkModeToggle) mobileDarkModeToggle.addEventListener('click', toggleDarkMode);
        }
        
        // モバイルメニュートグル
        function setupMobileMenu() {
            const mobileMenuButton = document.getElementById('mobileMenuButton');
            const mobileMenu = document.getElementById('mobileMenu');
            
            if (mobileMenuButton && mobileMenu) {
                mobileMenuButton.addEventListener('click', () => {
                    if (mobileMenu.classList.contains('hidden')) {
                        mobileMenu.classList.remove('hidden');
                        setTimeout(() => {
                            mobileMenu.classList.add('opacity-100');
                            mobileMenu.classList.remove('opacity-0');
                        }, 10);
                    } else {
                        mobileMenu.classList.add('opacity-0');
                        mobileMenu.classList.remove('opacity-100');
                        setTimeout(() => {
                            mobileMenu.classList.add('hidden');
                        }, 300);
                    }
                });
            }
        }
        
        // キャラクター選択
        function selectCharacter(character) {
            const characterSelection = document.getElementById('character-selection');
            const chatContainer = document.getElementById('chat-container');
            const chatAvatar = document.getElementById('chat-avatar');
            const chatName = document.getElementById('chat-name');
            const messagesContainer = document.getElementById('messages-container');
            
            // チャット画面を表示
            characterSelection.classList.add('hidden');
            chatContainer.classList.remove('hidden');
            
            // 選択したキャラクターの情報を設定
            let characterInfo = {
                name: '',
                avatar: '',
                firstMessage: ''
            };
            
            if (character === 'sakura') {
                characterInfo.name = 'さくら';
                characterInfo.avatar = 'https://images.unsplash.com/photo-1438761681033-6461ffad8d80?w=200&q=80';
                characterInfo.firstMessage = 'こんにちは！最近読んだ本で面白いものがあれば教えてほしいな。あと、おすすめのカフェがあったら行きたいです。';
            } else if (character === 'miki') {
                characterInfo.name = 'みき';
                characterInfo.avatar = 'https://images.unsplash.com/photo-1438761681033-6461ffad8d80?w=200&q=80';
                characterInfo.firstMessage = 'やっほー！先週行った音楽フェスが最高だったんだ。どんな音楽が好き？一緒にライブ行かない？';
            } else if (character === 'yuki') {
                characterInfo.name = 'ゆき';
                characterInfo.avatar = 'https://images.unsplash.com/photo-1438761681033-6461ffad8d80?w=200&q=80';
                characterInfo.firstMessage = 'こんにちは！私はジムインストラクターやってます。休日は友達とピクニックに行くのが好きなんだ。よかったらいつか一緒にどう？';
            }
            
            // キャラクター情報を表示
            chatAvatar.src = characterInfo.avatar;
            chatName.textContent = characterInfo.name;
            
            // 会話履歴をリセット
            messagesContainer.innerHTML = '';
            
            // 最初のメッセージを表示
            setTimeout(() => {
                appendMessage('ai', characterInfo.firstMessage);
            }, 1000);
        }
        
        // メッセージを追加
        function appendMessage(sender, message) {
            const messagesContainer = document.getElementById('messages-container');
            const messageElement = document.createElement('div');
            messageElement.className = `message-bubble ${sender}`;
            messageElement.textContent = message;
            
            if (sender === 'user') {
                messagesContainer.innerHTML += `<div class="flex justify-end">${messageElement.outerHTML}</div>`;
            } else {
                messagesContainer.innerHTML += `<div class="flex justify-start">${messageElement.outerHTML}</div>`;
            }
            
            // スクロールを最下部に移動
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }
        
        // タイピングインジケーターを表示
        function showTypingIndicator() {
            const messagesContainer = document.getElementById('messages-container');
            const indicatorHTML = `
                <div id="typing-indicator" class="flex justify-start">
                    <div class="message-bubble ai typing-indicator" style="padding: 10px 15px;">
                        <span></span>
                        <span></span>
                        <span></span>
                    </div>
                </div>
            `;
            messagesContainer.innerHTML += indicatorHTML;
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }
        
        // タイピングインジケーターを非表示
        function hideTypingIndicator() {
            const indicator = document.getElementById('typing-indicator');
            if (indicator) indicator.remove();
        }
        
        // メッセージ送信処理
        function setupMessageForm() {
            const messageForm = document.getElementById('message-form');
            const messageInput = document.getElementById('message-input');
            const chatName = document.getElementById('chat-name');
            
            if (messageForm) {
                messageForm.addEventListener('submit', (e) => {
                    e.preventDefault();
                    const message = messageInput.value.trim();
                    if (!message) return;
                    
                    // ユーザーメッセージを表示
                    appendMessage('user', message);
                    messageInput.value = '';
                    
                    // 返信を生成
                    showTypingIndicator();
                    
                    // AIの返信を生成（実際のアプリではAPIコール）
                    setTimeout(() => {
                        hideTypingIndicator();
                        
                        // シンプルなAPIコールを模倣
                        fetch('https://api.example.com/generate', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                prompt: message,
                                character: chatName.textContent,
                                temperature: 0.7,
                                topK: 40,
                                topP: 0.9,
                                safetySettings: [
                                    { category: "HARM_CATEGORY_HARASSMENT", threshold: "BLOCK_MEDIUM_AND_ABOVE" },
                                    { category: "HARM_CATEGORY_HATE_SPEECH", threshold: "BLOCK_MEDIUM_AND_ABOVE" },
                                    { category: "HARM_CATEGORY_SEXUALLY_EXPLICIT", threshold: "BLOCK_MEDIUM_AND_ABOVE" },
                                    { category: "HARM_CATEGORY_DANGEROUS_CONTENT", threshold: "BLOCK_MEDIUM_AND_ABOVE" }
                                ]
                            })
                        })
                        .then(response => response.json())
                        .then(data => {
                            // APIレスポンスの代わりに固定の返答
                            let aiResponse = '';
                            const characterName = chatName.textContent;
                            
                            if (characterName === 'さくら') {
                                aiResponse = '本当に興味深いお話ですね。もっと詳しく聞かせてもらえますか？美術館にも最近行ったんですけど、とても素敵な展示がありましたよ。';
                            } else if (characterName === 'みき') {
                                aiResponse = 'それ、すごく楽しそう！私も最近ライブに行きました。ぜひ写真も見せてほしいです！週末空いてたら、一緒に新しい場所に行きませんか？';
                            } else if (characterName === 'ゆき') {
                                aiResponse = 'ありがとう！健康的な生活って大事だよね。休日は公園でヨガやピクニックしたりするのが好きなんだ。あなたは休日はどんなことをして過ごしてるの？';
                            }
                            
                            appendMessage('ai', aiResponse);
                        })
                        .catch(error => {
                            console.error('Error:', error);
                            appendMessage('ai', 'すみません、エラーが発生しました。もう一度試してください。');
                        });
                    }, 1500);
                });
            }
        }
        
        // 戻るボタン
        function setupBackButton() {
            const backButton = document.getElementById('back-button');
            const characterSelection = document.getElementById('character-selection');
            const chatContainer = document.getElementById('chat-container');
            
            if (backButton) {
                backButton.addEventListener('click', () => {
                    characterSelection.classList.remove('hidden');
                    chatContainer.classList.add('hidden');
                });
            }
        }
        
        // ページ読み込み時に実行
        document.addEventListener('DOMContentLoaded', () => {
            setupDarkMode();
            setupMobileMenu();
            setupMessageForm();
            setupBackButton();
        });
    </script>
</body>
</html> 